#!/usr/bin/env node

try {
	const nodeRoot = require.resolve('grind-framework').replace(/node_modules\/.+?$/, 'node_modules')
	process.env.BASE_PATH = require('path').dirname(nodeRoot)
	process.env.WORKING_DIR = process.cwd()
	process.chdir(process.env.BASE_PATH)
} catch(err) {
	// eslint-disable-next-line no-console
	console.error('ERROR: Node packages do not appear to be installed.')
	process.exit(1)
}

const command = process.argv[2]
let file = null

if((command === 'watch' || command === 'serve') && !process.argv.includes('--help')) {
	file = '../boot/Http.js'

	if(command === 'watch') {
		process.argv.push('--watch=app,config')
	}
} else {
	file = '../boot/Cli.js'
	process.env.IN_CLI = 'true'
	process.env.CLI_BIN = process.argv[1]
}

require(process.argv[1] = file)
